
example_input = """...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#....."""

full_input = """.....................................................................................................#..................#......#............
...................#.........#...............................................#.........#...................#............................#...
............#.............................................#.................................................................................
.......#...............#...........#.............#.................................#............................#..................#........
..................................................................#........................................................................#
.........................................................................................#.......#..................#.......................
....#...........#.............................................#........................................#....................................
............................................................................................................................................
..........................................#....................................#...............................................#............
......................#..............................#..............................#...................................................#...
..............................................#..................#........................................................#.................
...#..............#...................................................#...................#................#........................#.......
.........................................................#..................#..................#............................................
...........#.................#....................#....................................................................#..................#.
.......................#...............................................................#........................................#...........
.#.....#........#...........................................#...........#...........................#.........#.............................
.....................................................................................................................................#......
.........................................#.........................................#..........#.........#.................#.................
.......................................................#....................#...............................................................
..................#.........#......................................#........................................................................
#...............................................#..............................................................#.................#..........
..........#............#..............................................................................#................#................#...
................................................................#.....................#.....#...............................................
...#...........#.....................#..............................................................................................#.......
...........................................#.........................#.......................................................#..............
.....................................................#......................#...............................................................
..............................................................................................#.............................................
.....................#....................................................................................#...........................#.....
............................#.......#............................................#...............................#...............#.........#
..#......#...............................................................................#.............................#....................
..................................................#...................................................#......................#..............
............................................#...............#...............................................................................
....................................................................#................#.......#..............................................
#..........................#.................................................#....................................................#.........
................................................#........................................................#.............................#....
.................................#........#..............................................#......................#...........................
.....................................................#............#....................................................#...................#
...........................................................................#................................................#...............
....#.......................................................#...............................................................................
..........#............................#..............................................#.....................................................
.......................................................#............................................#.....#...........................#.....
..................................................................................#............#...............#............................
.........................#....................#.....................#.....................................................................#.
..........................................................#...............................#..........................#......................
.................#.............#.........#........................................................#.........................#...............
..............................................................#.........................................#...................................
#..........#.....................................#..................................#........................#.......................#......
..................................#...................#...........#........#...................................................#............
...........................................#................................................................................................
........#...................................................................................................................................
.....................................................................................................................#....................#.
.#................#...........................#...........#....................#..............#...........#......................#..........
............................................................................................................................................
.......................#...............#..................................................#........#........................................
....#.........................................................#.............................................................................
....................................................................................................................................#.......
............................................................................................................#...............................
.............#.............................................................#......................................#...........#.............
.....................................#.....................................................#............#...................................
................................#.............#....................................................#.......................................#
......#..................#.............................................#..................................................#.................
..................#...................................#...........................#.................................................#.......
..............................................................................................#.............................................
...#...........................................................#............................................#...............................
............#.........#........................................................#.......................#..................................#.
..........................................#.........................................#...............................#.......#...............
............................#.....#.........................#.............................#.....#...........................................
....................................................#....................#......................................#...................#.......
..........................................................................................................#.................................
.....................#..........................................#...............................................................#...........
............................................................................................................................................
..............#..........................................................................................................................#..
.......................................#..................#........................................................#........................
.......................................................................#....................................................................
...............................................................................#...............#............................................
.........#.............#......#...............................#.....................................#.......................................
...........................................................................#......................................................#.........
.............#...........................#.......#.....................................#...................#................................
....................#................................................#................................................#....................#
..................................#...............................................#.........#...............................................
...........................#........................#....................#..................................................................
............................................#...........................................................#......#...........#...........#....
.......#.....................................................#.......................#......................................................
............................................................................................................................................
..............#........................................#...................................#.....#........................................#.
............................................................................................................................................
.........#..............#..........................................................#......................#.......................#.........
............................................................................................................................................
..........................................#......................#...................................#........................#.............
#.....#..........#........................................#....................#..........#..............................#............#.....
............................................................................................................................................
..........................................................................................................................................#.
...........................#................................................#....................................#..........................
.................................#..................................................#...................#...................................
................................................................................................................................#...........
.......#..............................#..............#......#...............................................................................
.............................#..........................................#...................................................................
..........................................#......#.........................................#................#.....#.........................
.#.....................#.................................#......#.....................................................................#.....
.....................................................................................#......................................................
......................................................................................................#.....................#...............
...................................................................#.........................#..............................................
.........................#..................#..............................................................................................#
............#......................................................................#...................................#....................
...................#..............#...................#............................................#.....#......................#......#....
.......................................#.........#......................#...................................................................
......#................#....................................................................................................................
.............................................................#..............................................................................
..............#.....................#..............................#........#.....................................#........................#
#...........................................#.....................................#......#.......#...............................#..........
...........................#............................................................................#...............#...................
.....................#...............................#......................................................................................
....#..........................#...............................................#.....#...................................................#..
......................................#.....................#...............................................................................
.............#.................................................................................................................#............
..............................................#.............................................#...............................................
.#.................................................................................................................................#........
................................#.......................................................................#...................................
..................#..............................#........................#.................................................................
........................#.................#............#.......#.....#................#.......#...........................................#.
..............#.....................................................................................#...........................#...........
......................................#.........................................................................#.......#.............#.....
..#.....#.................................................#.................#..............#................................................
......................#.......#.............................................................................................................
.......................................................................................#............................#.......................
.............#.............................#......#.........................................................................................
................................................................#..................#.................#........................#.............
..................#........#..........................................#.....................#...............................................
..........#............................#..................................................................................................#.
..................................................................................................#.........................................
..............#.......#...........#...........#........#..........#..................#......................#.............#.......#.........
.....#......................................................................................................................................
..........................................#.............................#.......................................#...........................
..........................#..............................................................................#..................................
.#............................................................#................................................................#..........#.
..................#............#..................#...................................#.....................................................
........#...............................................................................................................#...................
......................#.............#.................#...........#..........#....................#.........................................
............#......................................................................#......................#.................#........#......
..#.........................#................#............#.........................................................#......................#"""





def serialize_input(input_string):
    return [list(line) for line in input_string.split("\n")]

def expand_universe(universe):
    horizontally_expanded_universe = []
    # we expand horizontally first
    for line in universe:
        if len(set(line)) == 1 and "." in set(line):
            horizontally_expanded_universe.append(list("".join(line).replace(".", "-")))
        else:
            horizontally_expanded_universe.append(line)
        
    
    # we expand vertically
    transposed_list = [[line[i] for line in horizontally_expanded_universe] for i in range(len(horizontally_expanded_universe[0]))] 
    new_transposed_list = []
    for column in transposed_list:
        if len(set(column)) == 1 or (len(set(column)) == 2 and {".", "-"} == set(column)):
            new_transposed_list.append(list("".join(column).replace(".", "|")))
        else: 
            new_transposed_list.append(column)

    # we transpose the list back to it's original orientation 
    expanded_universe = [[line[i] for line in new_transposed_list] for i in range(len(new_transposed_list[0]))]

    return expanded_universe
            

def calculate_distances(input_universe):
    expantion_eff = 1000000

    expanded_universe = expand_universe(input_universe)
    galaxy_coordinates = {}

    galaxy_number = 1
    y = 0
    trav_expanded_y = 0
    while y < len(expanded_universe):
        x = 0
        trav_expanded_x = 0
        while x < len(expanded_universe[0]):
            # print(x,y)
            curr_char = expanded_universe[y][x]
            if curr_char == "#":
                galaxy_coordinates[galaxy_number] = (x+trav_expanded_x,y+trav_expanded_y)
                galaxy_number += 1
            elif curr_char == "-":
                trav_expanded_y += expantion_eff-1
                y += 1
                x = 0
            elif curr_char == "|":
                trav_expanded_x += expantion_eff-1
            # print(trav_expanded_y)

            x += 1

        trav_expanded_x = 0
        y += 1

    # print(galaxy_coordinates)
    distances = [] 

    for i in range(len(galaxy_coordinates)-1):
        coordinate_values = list(galaxy_coordinates.values())
        lengths = []
        curr_galaxy = coordinate_values[i]
        other_galaxies = coordinate_values[i+1:]
        for galaxy in other_galaxies:
            distance = abs(curr_galaxy[0] - galaxy[0]) + abs(curr_galaxy[1] - galaxy[1])
            
            # print(distance, curr_galaxy, galaxy)
            lengths.append(distance)
        distances += lengths
    
    return sum(distances)

# print(*[" ".join(line) for line in expand_universe(serialize_input(example_input))],sep="\n")
print(calculate_distances(serialize_input(example_input)))
print(calculate_distances(serialize_input(full_input)))
